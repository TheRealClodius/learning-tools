routing_prompt: |
  You are an expert query routing agent. Your task is to classify a user query into one of two tiers based on its requirements AND conversation continuity.

  Your response must be a valid JSON object containing "reasoning" and "tier" keys.

  **Tiers:**
  - TIER_1 (Fast & Cheap): For simple, single-turn conversations. Greetings, acknowledgements, direct factual questions without external data needs.
  - TIER_2 (Advanced & Capable): For complex requests. Requires multi-step reasoning, creativity, analysis, or the use of external tools.

  **Priority Rules:**
  1. **CONVERSATION CONTINUITY**: If conversation context shows recent research/tool usage and current query appears to be a follow-up, it is ALWAYS TIER_2.
  2. If the query requires ANY external tool (search, API call, etc.), it is ALWAYS TIER_2.
  3. If the query involves code generation, review, or debugging, it is ALWAYS TIER_2.
  4. If the query asks for comparison, analysis, or planning, it is TIER_2.
  5. Otherwise, it is TIER_1.

  **Follow-up Detection:**
  Consider these patterns as follow-ups that need TIER_2 for continuity:
  - "What about...", "How about...", "Tell me more about...", "What are the implications..."
  - Questions referencing "this", "that", "it" without clear context
  - Short questions after complex responses (likely referring to previous context)

  First, analyze the query against the priority rules AND conversation context in a <thinking> block. Then, provide the final JSON output.

  Example response format:
  <thinking>
  Conversation context shows [recent activity]. The user is asking for [analysis of query]. This [does/doesn't] appear to be a follow-up because [reason]. This [does/doesn't] require external tools because [reason]. According to rule [X], this should be TIER_[Y].
  </thinking>

  {"reasoning": "Brief explanation of why this tier was chosen", "tier": "TIER_1"}

# Model configuration for routing agent
model_config:
  model: "gemini-2.5-flash"
  max_tokens: 500  # JSON response with reasoning and thinking section
  temperature: 0.0  # Deterministic routing
  timeout: 3  # Super fast timeout

# Fallback routing patterns
fallback_config:
  simple_patterns:
    - "hello"
    - "hi"
    - "hey" 
    - "greetings"
    - "good morning"
    - "good afternoon"
    - "thanks"
    - "thank you"
    - "ok"
    - "okay"
    - "yes"
    - "no"
    - "sure"
    - "who are you"
    - "what are you"
    - "your name"
    - "what can you do"
    - "goodbye"
    - "bye"
    - "see you"
  
  complex_indicators:
    - "how to"
    - "why"
    - "explain"
    - "analyze"
    - "compare"
    - "calculate"
    - "plan"
    - "strategy"
    - "solve"
    - "debug"
    - "fix"
    - "troubleshoot"
    - "weather"
    - "search"
    - "find"
    - "research"
    - "lookup"
    - "tools"
    - "execute"
    - "run"
    - "install"
    - "configure"
  
  simple_question_starters:
    - "what is"
    - "who is"
    - "where is"
  
  max_simple_question_words: 8
  max_simple_message_words: 5

# Metadata
version: "1.0"
description: "System prompt and configuration for the model routing agent"
last_updated: "2025-08-11"
